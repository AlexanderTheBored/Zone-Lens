<!-- index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="./favicon.png" type="image/png" />
  <title>Zone|Lens – Mandaue Flood Risk Analysis</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

  <!-- Mapbox GL -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

  <!-- Your CSS -->
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div id="map"></div>

  <!-- Compass display (top center) -->
  <div class="compass-container" id="compassContainer">
    <div class="compass-display">
      <div class="compass-north" id="compassNorth">N</div>
      <div class="compass-divider"></div>
      <div class="compass-bearing" id="compassBearing">0°</div>
    </div>
  </div>

  <div class="search-box">
    <input type="text" id="searchInput" class="search-input"
      placeholder="Search for address, building, or place in Mandaue..." autocomplete="off" />
    <div id="searchResults" class="search-results"></div>
  </div>

  <div class="controls">
    <h3>
      Project Filter
      <span class="tooltip-icon"
        data-tooltip="Filter zones by project type to see which areas allow specific developments">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
      </span>
    </h3>

    <p class="control-help-text">Select zones by permitted project type. Check flood risk below.</p>

    <!-- Visibility Toggle -->
    <label class="filter-visibility-toggle">
      <span>Show Filtered Zones Only</span>
      <input type="checkbox" id="filterVisibilityToggle" checked>
    </label>

    <!-- Filters Container -->
    <div class="filters-container" id="filtersContainer">
      <button class="filter-btn" data-filter="all">
        <span>View All Zones</span>
      </button>
      <button class="filter-btn" data-filter="none">
        <span>Hide All Zones</span>
      </button>
      <button class="filter-btn" data-filter="house">
        <span>Residential Project</span>
      </button>
      <button class="filter-btn" data-filter="factory">
        <span>Industrial Facility</span>
      </button>
      <button class="filter-btn" data-filter="mall">
        <span>Commercial Complex</span>
      </button>
    </div>
  </div>

  <!-- Right Sidebar Container - Manages all right-side panels -->
  <div class="right-sidebar">

    <!-- Map Layers Panel -->
    <section class="panel panel-map-layers">
      <h3>
        Map Layers
        <span class="tooltip-icon"
          data-tooltip="Toggle visualization layers to analyze terrain elevation, buildings, and water features">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
        </span>
      </h3>

      <!-- Terrain & Structures Section -->
      <div class="layer-section">
        <div class="layer-section-label">Terrain & Structures</div>
        <div class="layer-toggle-row">
          <button class="layer-toggle" id="terrainBtn" data-layer="terrain" title="Toggle 3D terrain">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z" />
            </svg>
            <span>3D Terrain</span>
          </button>
        </div>
        <div class="layer-toggle-row">
          <button class="layer-toggle" id="buildingsBtn" data-layer="buildings" title="Toggle 3D buildings">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" />
            </svg>
            <span>3D Buildings</span>
          </button>
        </div>
      </div>

      <!-- Risk Layers Section -->
      <div class="layer-section">
        <div class="layer-section-label">Risk Layers</div>
        <div class="layer-toggle-row">
          <button class="layer-toggle" id="floodBtn" data-layer="flood" title="Toggle flood risk zones">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" />
            </svg>
            <span>Flood Risk</span>
          </button>
        </div>
      </div>

      <!-- Reference Layers Section -->
      <div class="layer-section">
        <div class="layer-section-label">Reference Layers</div>
        <div class="layer-toggle-row">
          <button class="layer-toggle" id="riverBtn" data-layer="river" title="Toggle water bodies">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-0.9-2-2-2zM1 6c0 2.21 1.79 4 4 4s4-1.79 4-4-1.79-4-4-4S1 3.79 1 6zm16 0c0 2.21 1.79 4 4 4s4-1.79 4-4-1.79-4-4-4-4 1.79-4 4zm-8 12c0 2.21 1.79 4 4 4s4-1.79 4-4-1.79-4-4-4-4 1.79-4 4zm8-8c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
            </svg>
            <span>Water Bodies</span>
          </button>
        </div>
        <div class="layer-toggle-row">
          <button class="layer-toggle" id="contourBtn" data-layer="contour" title="Toggle elevation lines">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M3 9h4V5H3v4zm0 5h4v-4H3v4zm5 0h4v-4H8v4zm5 0h4v-4h-4v4zm-10 5h4v-4H3v4zm5 0h4v-4H8v4zm5 0h4v-4h-4v4zm5-14v4h4V5h-4zm0 9h4v-4h-4v4z" />
            </svg>
            <span>Elevation Lines</span>
          </button>
        </div>
      </div>

      <div class="info-box">
        <strong>Data Sources:</strong><br>
        <small>MCDRRMO 2022–2025<br>Flood incidents</small><br><br>
        <strong>Last Major Event:</strong><br>
        <small>Nov 2025: 29,000+ evacuated</small><br><br>
        <em>Layers combine zoning regulations with historical flood risk. Use together for complete risk
          assessment.</em>
      </div>
    </section>

    <!-- Data Sources Panel -->
    <section class="panel panel-data-sources">
      <h4>
        Data Sources & Events
        <span class="tooltip-icon"
          data-tooltip="Information about data sources, update frequency, and recent incidents">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
        </span>
      </h4>
      <div class="data-source-item">
        <strong>Primary Source:</strong><br>
        <small>MCDRRMO (Mandaue City Disaster Risk Reduction Management Office)</small>
      </div>
      <div class="data-source-item">
        <strong>Data Period:</strong><br>
        <small>2022–2025 (Current)</small>
      </div>
      <div class="data-source-item">
        <strong>Last Updated:</strong><br>
        <small id="dataSourceTimestamp">November 2025</small>
      </div>
      <div class="data-source-item highlight">
        <strong>Latest Event:</strong><br>
        <small>29,000+ evacuated (Nov 2025)</small>
      </div>
    </section>

    <!-- Legend Panel -->
    <section class="panel panel-legend">
      <h4>
        Zoning Districts
        <span class="tooltip-icon"
          data-tooltip="Official Mandaue City Zoning Map 2019-2029 - Color-coded zones showing permitted land use types">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
        </span>
      </h4>

      <!-- Commercial Zones -->
      <div
        style="font-size:9px;font-weight:700;color:#64748b;margin:8px 0 4px 0;text-transform:uppercase;letter-spacing:0.5px;">
        Commercial</div>
      <div class="legend-item"><span class="color-box" style="background:#C53D3F"></span>C-I</div>
      <div class="legend-item"><span class="color-box" style="background:#B42F2F"></span>C-II</div>
      <div class="legend-item"><span class="color-box" style="background:#8F1D23"></span>C-III</div>
      <div class="legend-item"><span class="color-box" style="background:#E69CE1"></span>City Core Commercial</div>

      <!-- Industrial Zones -->
      <div
        style="font-size:9px;font-weight:700;color:#64748b;margin:8px 0 4px 0;text-transform:uppercase;letter-spacing:0.5px;">
        Industrial</div>
      <div class="legend-item"><span class="color-box" style="background:#D40FA6"></span>I-II</div>
      <div class="legend-item"><span class="color-box" style="background:#980A6D"></span>I-III</div>

      <!-- Residential Zones -->
      <div
        style="font-size:9px;font-weight:700;color:#64748b;margin:8px 0 4px 0;text-transform:uppercase;letter-spacing:0.5px;">
        Residential</div>
      <div class="legend-item"><span class="color-box" style="background:#C4D61F"></span>Light Density</div>
      <div class="legend-item"><span class="color-box" style="background:#BBAD43"></span>Medium Density</div>
      <div class="legend-item"><span class="color-box" style="background:#C6983B"></span>High Density</div>
      <div class="legend-item"><span class="color-box" style="background:#90633A"></span>Socialized Housing</div>

      <!-- Environmental Zones -->
      <div
        style="font-size:9px;font-weight:700;color:#64748b;margin:8px 0 4px 0;text-transform:uppercase;letter-spacing:0.5px;">
        Environmental</div>
      <div class="legend-item"><span class="color-box" style="background:#88A331"></span>Parks & Open Spaces</div>
      <div class="legend-item"><span class="color-box" style="background:#A8D52F"></span>Cemeteries</div>
      <div class="legend-item"><span class="color-box" style="background:#256623"></span>Mangrove Areas</div>
      <div class="legend-item"><span class="color-box" style="background:#10850F"></span>50m Green Corridor</div>
      <div class="legend-item"><span class="color-box" style="background:#31969C"></span>Aquaculture</div>

      <!-- Institutional Zones -->
      <div
        style="font-size:9px;font-weight:700;color:#64748b;margin:8px 0 4px 0;text-transform:uppercase;letter-spacing:0.5px;">
        Institutional</div>
      <div class="legend-item"><span class="color-box" style="background:#1418BC"></span>Government</div>
      <div class="legend-item"><span class="color-box" style="background:#7745A8"></span>Historical Strip</div>

      <!-- Special Zones -->
      <div
        style="font-size:9px;font-weight:700;color:#64748b;margin:8px 0 4px 0;text-transform:uppercase;letter-spacing:0.5px;">
        Special Zones</div>
      <div class="legend-item"><span class="color-box" style="background:#6B7280"></span>PEZA</div>
      <div class="legend-item"><span class="color-box" style="background:#4B5563"></span>PUD</div>
      <div class="legend-item"><span class="color-box" style="background:#9CA3AF"></span>Recreation & Tourism</div>
      <div class="legend-item"><span class="color-box" style="background:#111111"></span>Utilities</div>

      <h4 style="margin-top:14px;">
        Flood Risk Zones
        <span class="tooltip-icon"
          data-tooltip="Historical flood data showing water depth levels during typhoons and heavy rainfall">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
        </span>
      </h4>
      <div class="legend-item"><span class="color-box" style="background:#d32f2f"></span>Critical (Roof-level)</div>
      <div class="legend-item"><span class="color-box" style="background:#ff7043"></span>High Risk (Chest-deep)</div>
      <div class="legend-item"><span class="color-box" style="background:#ffb74d"></span>Moderate (Knee-deep)</div>
      <div class="legend-item"><span class="color-box" style="background:#fff59d"></span>Low (Street flooding)</div>
    </section>

  </div>
  <!-- End right-sidebar -->

  <!-- Map Metadata Bar (bottom left) -->
  <div class="map-metadata">
    <span class="data-timestamp" id="dataTimestamp">Data updated: Nov 2025</span>
  </div>

  <!-- Map Controls Bar (bottom right) -->
  <div class="map-controls-bar">
    <button class="map-control-btn" id="resetViewBtn" title="Reset map view" aria-label="Reset map to default view">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
        <path d="M3 3v5h5"></path>
      </svg>
    </button>
  </div>

  <!-- AI Chatbot Interface -->
  <button class="chatbot-button" id="chatbotToggle" aria-label="Open BelaBot">
    <svg viewBox="0 0 100 100">
      <!-- Ears -->
      <path d="M30,40 Q20,5 35,5 Q50,5 45,40" fill="#e0e0e0" />
      <path d="M70,40 Q80,5 65,5 Q50,5 55,40" fill="#e0e0e0" />

      <!-- Head -->
      <circle cx="50" cy="60" r="30" fill="#ffffff" />

      <!-- Visor -->
      <rect x="28" y="52" width="44" height="20" rx="8" fill="#111" />

      <!-- Eyes with purple glow animation -->
      <circle cx="42" cy="62" r="4" fill="#a855f7" class="eye-glow" />
      <circle cx="58" cy="62" r="4" fill="#a855f7" class="eye-glow" />

      <!-- Hat - Purple -->
      <path d="M25,45 Q50,5 75,45" fill="#a855f7" stroke="none" />
      <path d="M20,45 L80,45 Q82,50 78,50 L22,50 Q18,50 20,45" fill="#a855f7" />
      <path d="M50,15 L50,45" stroke="#8b5cf6" stroke-width="2" />

      <!-- BB Logo on hat -->
      <text x="50" y="38" class="hat-logo">BB</text>

      <!-- Smile - Purple -->
      <path d="M28,80 Q50,92 72,80" stroke="#a855f7" stroke-width="4" stroke-linecap="round" fill="none" />
    </svg>
  </button>

  <div class="chatbot-window" id="chatbotWindow">
    <div class="chatbot-header">
      <svg viewBox="0 0 100 100" class="belabot-header-icon">
        <!-- Ears -->
        <path d="M30,40 Q20,5 35,5 Q50,5 45,40" fill="#e0e0e0" />
        <path d="M70,40 Q80,5 65,5 Q50,5 55,40" fill="#e0e0e0" />

        <!-- Head -->
        <circle cx="50" cy="60" r="30" fill="#ffffff" />

        <!-- Visor -->
        <rect x="28" y="52" width="44" height="20" rx="8" fill="#111" />

        <!-- Eyes with purple glow animation -->
        <circle cx="42" cy="62" r="4" fill="#7c3aed" class="eye-glow" />
        <circle cx="58" cy="62" r="4" fill="#7c3aed" class="eye-glow" />

        <!-- Hat - Purple (darker for contrast on purple header) -->
        <path d="M25,45 Q50,5 75,45" fill="#7c3aed" stroke="none" />
        <path d="M20,45 L80,45 Q82,50 78,50 L22,50 Q18,50 20,45" fill="#7c3aed" />
        <path d="M50,15 L50,45" stroke="#6d28d9" stroke-width="2" />

        <!-- BB Logo on hat -->
        <text x="50" y="38" class="hat-logo">BB</text>

        <!-- Smile - Dark purple for contrast -->
        <path d="M28,80 Q50,92 72,80" stroke="#6d28d9" stroke-width="4" stroke-linecap="round" fill="none" />
      </svg>
      <h3>BelaBot</h3>
      <button class="close-btn" id="chatbotClose" aria-label="Close">&times;</button>
    </div>

    <div class="chatbot-messages" id="chatbotMessages">
      <div class="chat-message system">
        Welcome! I can help you understand flood risks, zoning regulations, and map features. Ask me anything!
      </div>
    </div>

    <div class="chatbot-input-area">
      <input type="text" class="chatbot-input" id="chatbotInput"
        placeholder="Ask about flood zones, zoning, or map features..." autocomplete="off" />
      <button class="chatbot-send-btn" id="chatbotSend">Send</button>
    </div>
  </div>

  <!-- Embedded GeoJSON Data (avoids fetch for file:// protocol) -->
  <script src="./mandaue-data-v2.js"></script>

  <!-- Your JS -->
  <script src="flood-data.js"></script>
  <script src="app.js"></script>
</body>

</html>
